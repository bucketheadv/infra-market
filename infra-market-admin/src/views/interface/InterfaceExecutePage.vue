<template>
  <div class="interface-execute-page">
    <div class="form-header">
      <div class="header-content">
        <div class="header-icon">
          <PlayCircleOutlined />
        </div>
        <div class="header-text">
          <div class="header-title">Êé•Âè£ÊâßË°å</div>
          <div class="header-subtitle">{{ interfaceData?.name || 'Êé•Âè£ÊµãËØï' }}</div>
        </div>
      </div>
    </div>

    <div class="form-content">
      <a-card class="form-card" :bordered="false">
        <!-- Âü∫Êú¨‰ø°ÊÅØÂå∫Âüü -->
        <div class="form-section">
          <div class="section-header">
            <div class="section-icon">
              <span>üìã</span>
            </div>
            <div class="section-title">Êé•Âè£Âü∫Êú¨‰ø°ÊÅØ</div>
          </div>
          
          <div v-if="loading" class="loading-container">
            <a-spin size="large" />
          </div>
          <div v-else-if="interfaceData" class="interface-info">
            <a-descriptions :column="2" :bordered="false" size="small">
              <a-descriptions-item label="Êé•Âè£ÂêçÁß∞">
                <span class="info-value">{{ interfaceData.name }}</span>
              </a-descriptions-item>
              <a-descriptions-item label="ËØ∑Ê±ÇÊñπÊ≥ï">
                <a-tag :color="getMethodColor(interfaceData.method)" class="method-tag">
                  {{ interfaceData.method }}
                </a-tag>
              </a-descriptions-item>
              <a-descriptions-item label="ËØ∑Ê±ÇURL" :span="2">
                <code class="url-text">{{ interfaceData.url }}</code>
              </a-descriptions-item>
              <a-descriptions-item label="Êé•Âè£ÊèèËø∞" :span="2">
                <span class="description-text">{{ interfaceData.description || 'ÊöÇÊó†ÊèèËø∞' }}</span>
              </a-descriptions-item>
              <a-descriptions-item v-if="interfaceData.postType" label="POSTÁ±ªÂûã">
                <a-tag color="blue" class="post-type-tag">{{ getPostTypeLabel(interfaceData.postType) }}</a-tag>
              </a-descriptions-item>
              <a-descriptions-item label="Áä∂ÊÄÅ">
                <a-tag :color="interfaceData.status === 1 ? 'green' : 'red'" class="status-tag">
                  {{ interfaceData.status === 1 ? 'ÂêØÁî®' : 'Á¶ÅÁî®' }}
                </a-tag>
              </a-descriptions-item>
              <a-descriptions-item label="ÂàõÂª∫Êó∂Èó¥">
                <span class="time-text">{{ formatDateTime(interfaceData.createTime) }}</span>
              </a-descriptions-item>
              <a-descriptions-item label="Êõ¥Êñ∞Êó∂Èó¥">
                <span class="time-text">{{ formatDateTime(interfaceData.updateTime) }}</span>
              </a-descriptions-item>
            </a-descriptions>
          </div>
        </div>

        <a-row :gutter="24" class="content-row">
        <!-- Â∑¶‰æßÔºöÂèÇÊï∞ÈÖçÁΩÆ -->
        <a-col :span="12">
          <div class="form-section">
            <div class="section-header">
              <div class="section-icon">
                <span>‚öôÔ∏è</span>
              </div>
              <div class="section-title">ÂèÇÊï∞ÈÖçÁΩÆ</div>
            </div>
            <div v-if="loading" class="loading-container">
              <a-spin size="large" />
            </div>
            <div v-else>
              <a-form ref="formRef" :model="executeForm" layout="vertical">
                <!-- URLÂèÇÊï∞ -->
                <div v-if="urlParams.length > 0" class="param-group">
                  <h4>URLÂèÇÊï∞</h4>
                  <a-row v-for="param in urlParams" :key="param.name" class="param-row">
                    <a-col :span="8">
                      <label class="param-label">
                        {{ param.name }}
                        <span v-if="param.required" class="required">*</span>
                      </label>
                    </a-col>
                    <a-col :span="16">
                      <a-form-item
                        :name="['params', param.name]"
                        :rules="param.required ? [{ required: true, message: `ËØ∑ËæìÂÖ•${param.name}` }] : []"
                      >
                        <!-- ‰ª£Á†ÅÁºñËæëÂô®ÂºπÁ™óÊåâÈíÆ -->
                        <div v-if="param.inputType === 'CODE'" class="code-editor-input">
                          <a-input
                            :value="getCodePreview(executeForm.params[param.name])"
                            :placeholder="`ËØ∑ËæìÂÖ•${param.name}`"
                            :disabled="!param.changeable"
                            readonly
                            class="code-preview-input"
                            @click="!param.changeable || openCodeEditor(param, 'params')"
                          >
                            <template #suffix>
                              <ThemeButton
                                v-if="param.changeable"
                                variant="secondary"
                                size="small"
                                @click.stop="openCodeEditor(param, 'params')"
                              >
                                <template #icon>
                                  <span>üìù</span>
                                </template>
                                ÁºñËæë
                              </ThemeButton>
                            </template>
                          </a-input>
                        </div>
                        <!-- ÂÖ∂‰ªñËæìÂÖ•ÁªÑ‰ª∂ -->
                        <component
                          v-else
                          :is="getInputComponent(param)"
                          v-bind="getInputBindings(param, 'params')"
                          :placeholder="`ËØ∑ËæìÂÖ•${param.name}`"
                          :options="param.options"
                          :disabled="!param.changeable"
                          :required="param.required"
                        />
                      </a-form-item>
                    </a-col>
                  </a-row>
                </div>

                <!-- HeaderÂèÇÊï∞ -->
                <div v-if="headerParams.length > 0" class="param-group">
                  <h4>HeaderÂèÇÊï∞</h4>
                  <a-row v-for="param in headerParams" :key="param.name" class="param-row">
                    <a-col :span="8">
                      <label class="param-label">
                        {{ param.name }}
                        <span v-if="param.required" class="required">*</span>
                      </label>
                    </a-col>
                    <a-col :span="16">
                      <a-form-item
                        :name="['headers', param.name]"
                        :rules="param.required ? [{ required: true, message: `ËØ∑ËæìÂÖ•${param.name}` }] : []"
                      >
                        <!-- ‰ª£Á†ÅÁºñËæëÂô®ÂºπÁ™óÊåâÈíÆ -->
                        <div v-if="param.inputType === 'CODE'" class="code-editor-input">
                          <a-input
                            :value="getCodePreview(executeForm.headers[param.name])"
                            :placeholder="`ËØ∑ËæìÂÖ•${param.name}`"
                            :disabled="!param.changeable"
                            readonly
                            class="code-preview-input"
                            @click="!param.changeable || openCodeEditor(param, 'headers')"
                          >
                            <template #suffix>
                              <ThemeButton
                                v-if="param.changeable"
                                variant="secondary"
                                size="small"
                                @click.stop="openCodeEditor(param, 'headers')"
                              >
                                <template #icon>
                                  <span>üìù</span>
                                </template>
                                ÁºñËæë
                              </ThemeButton>
                            </template>
                          </a-input>
                        </div>
                        <!-- ÂÖ∂‰ªñËæìÂÖ•ÁªÑ‰ª∂ -->
                        <component
                          v-else
                          :is="getInputComponent(param)"
                          v-bind="getInputBindings(param, 'headers')"
                          :placeholder="`ËØ∑ËæìÂÖ•${param.name}`"
                          :options="param.options"
                          :disabled="!param.changeable"
                          :required="param.required"
                        />
                      </a-form-item>
                    </a-col>
                  </a-row>
                </div>

                <!-- BodyÂèÇÊï∞ -->
                <div v-if="bodyParams.length > 0 && interfaceData?.method !== 'GET'" class="param-group">
                  <h4>BodyÂèÇÊï∞</h4>
                  <a-row v-for="param in bodyParams" :key="param.name" class="param-row">
                    <a-col :span="8">
                      <label class="param-label">
                        {{ param.name }}
                        <span v-if="param.required" class="required">*</span>
                      </label>
                    </a-col>
                    <a-col :span="16">
                      <a-form-item
                        :name="['bodyParams', param.name]"
                        :rules="param.required ? [{ required: true, message: `ËØ∑ËæìÂÖ•${param.name}` }] : []"
                      >
                        <!-- ‰ª£Á†ÅÁºñËæëÂô®ÂºπÁ™óÊåâÈíÆ -->
                        <div v-if="param.inputType === 'CODE'" class="code-editor-input">
                          <a-input
                            :value="getCodePreview(executeForm.bodyParams[param.name])"
                            :placeholder="`ËØ∑ËæìÂÖ•${param.name}`"
                            :disabled="!param.changeable"
                            readonly
                            class="code-preview-input"
                            @click="!param.changeable || openCodeEditor(param, 'bodyParams')"
                          >
                            <template #suffix>
                              <ThemeButton
                                v-if="param.changeable"
                                variant="secondary"
                                size="small"
                                @click.stop="openCodeEditor(param, 'bodyParams')"
                              >
                                <template #icon>
                                  <span>üìù</span>
                                </template>
                                ÁºñËæë
                              </ThemeButton>
                            </template>
                          </a-input>
                        </div>
                        <!-- ÂÖ∂‰ªñËæìÂÖ•ÁªÑ‰ª∂ -->
                        <component
                          v-else
                          :is="getInputComponent(param)"
                          v-bind="getInputBindings(param, 'bodyParams')"
                          :placeholder="`ËØ∑ËæìÂÖ•${param.name}`"
                          :options="param.options"
                          :disabled="!param.changeable"
                          :required="param.required"
                        />
                      </a-form-item>
                    </a-col>
                  </a-row>
                </div>

                <div v-if="urlParams.length === 0 && headerParams.length === 0 && bodyParams.length === 0" class="no-params">
                  <a-empty description="ËØ•Êé•Âè£Êó†ÈúÄÈÖçÁΩÆÂèÇÊï∞" />
                </div>
              </a-form>
            </div>
          </div>
        </a-col>

        <!-- Âè≥‰æßÔºöÊâßË°åÁªìÊûú -->
        <a-col :span="12">
          <div class="form-section">
            <div class="section-header">
              <div class="section-icon">
                <span>üìä</span>
              </div>
              <div class="section-title">ÊâßË°åÁªìÊûú</div>
            </div>
            <div v-if="!executeResult" class="no-result">
              <a-empty description="ÁÇπÂáªÊâßË°åÊåâÈíÆÂºÄÂßãÊµãËØïÊé•Âè£" />
            </div>
            <div v-else>
              <a-tabs v-model:activeKey="activeTab">
                <a-tab-pane key="response" tab="ÂìçÂ∫îÂÜÖÂÆπ">
                  <div class="response-container">
                    <div class="response-header">
                      <a-tag :color="executeResult.success ? 'green' : 'red'">
                        {{ executeResult.status }}
                      </a-tag>
                      <span class="response-time">
                        ÂìçÂ∫îÊó∂Èó¥: {{ executeResult.responseTime }}ms
                      </span>
                    </div>
                    <div class="response-body">
                      <CodeEditor
                        :model-value="formatResponseBody(executeResult.body)"
                        :readonly="true"
                        :height="400"
                        :language="detectResponseLanguage(executeResult.body)"
                        :options="{
                          minimap: { enabled: true },
                          scrollBeyondLastLine: false,
                          wordWrap: 'on',
                          lineNumbers: 'on',
                          folding: true,
                          fontSize: 10,
                          fontFamily: 'Monaco, Menlo, Ubuntu Mono, monospace',
                          lineHeight: 16,
                          readOnly: true
                        }"
                      />
                    </div>
                  </div>
                </a-tab-pane>
                <a-tab-pane key="headers" tab="ÂìçÂ∫îÂ§¥">
                  <div class="headers-container">
                    <pre>{{ formatHeaders(executeResult.headers) }}</pre>
                  </div>
                </a-tab-pane>
                <a-tab-pane v-if="executeResult.error" key="error" tab="ÈîôËØØ‰ø°ÊÅØ">
                  <div class="error-container">
                    <pre>{{ executeResult.error }}</pre>
                  </div>
                </a-tab-pane>
              </a-tabs>
            </div>
          </div>
        </a-col>
        </a-row>

        <!-- Êìç‰ΩúÊåâÈíÆÂå∫Âüü -->
        <div class="form-actions">
          <a-space size="small">
            <ThemeButton 
              variant="primary" 
              size="small"
              :icon="PlayCircleOutlined"
              :disabled="executing"
              @click="handleExecute"
              class="submit-btn"
            >
              ÊâßË°åÊé•Âè£
            </ThemeButton>
            <ThemeButton 
              variant="secondary"
              size="small"
              :icon="CloseOutlined"
              @click="handleBack"
              class="cancel-btn"
            >
              ËøîÂõû
            </ThemeButton>
          </a-space>
        </div>
      </a-card>
    </div>

    <!-- ‰ª£Á†ÅÁºñËæëÂô®ÂºπÁ™ó -->
    <CodeEditorModal
      v-model:visible="codeEditorVisible"
      v-model:value="tempCodeValue"
      :language="getCodeLanguage()"
      :placeholder="getCodePlaceholder()"
      @confirm="handleCodeConfirm"
      @cancel="handleCodeCancel"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, computed, onMounted } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import { message } from 'ant-design-vue'
import { PlayCircleOutlined, CloseOutlined } from '@ant-design/icons-vue'
import { interfaceApi, POST_TYPES, type ApiInterface, type ApiParam, type ApiExecuteRequest, type ApiExecuteResponse } from '@/api/interface'
import ThemeButton from '@/components/ThemeButton.vue'
import CodeEditor from '@/components/CodeEditor.vue'
import CodeEditorModal from '@/components/CodeEditorModal.vue'

const route = useRoute()
const router = useRouter()

// ÂìçÂ∫îÂºèÊï∞ÊçÆ
const formRef = ref()
const loading = ref(false)
const executing = ref(false)
const interfaceData = ref<ApiInterface | null>(null)
const executeResult = ref<ApiExecuteResponse | null>(null)
const activeTab = ref('response')

// ‰ª£Á†ÅÁºñËæëÂô®ÂºπÁ™óÁõ∏ÂÖ≥
const codeEditorVisible = ref(false)
const tempCodeValue = ref('')
const currentCodeParam = ref<{ param: ApiParam, type: 'params' | 'headers' | 'bodyParams' } | null>(null)

const executeForm = reactive({
  params: {} as Record<string, any>,
  headers: {} as Record<string, any>,
  bodyParams: {} as Record<string, any>
})

// Ëé∑ÂèñÊé•Âè£ID
const interfaceId = route.params.id as string

// ËÆ°ÁÆóÂ±ûÊÄß
const urlParams = computed(() => interfaceData.value?.urlParams || [])
const headerParams = computed(() => interfaceData.value?.headerParams || [])
const bodyParams = computed(() => interfaceData.value?.bodyParams || [])

// ÂàùÂßãÂåñÊï∞ÊçÆ
onMounted(async () => {
  if (interfaceId) {
    await loadInterfaceData()
  } else {
    message.error('Êé•Âè£ID‰∏çÂ≠òÂú®')
    router.back()
  }
})

// Âä†ËΩΩÊé•Âè£Êï∞ÊçÆ
const loadInterfaceData = async () => {
  try {
    loading.value = true
    const response = await interfaceApi.getById(Number(interfaceId))
    interfaceData.value = response.data
    
    // ÂàùÂßãÂåñË°®ÂçïÊï∞ÊçÆ
    initializeFormData()
  } catch (error) {
    console.error('Âä†ËΩΩÊé•Âè£Êï∞ÊçÆÂ§±Ë¥•:', error)
    message.error('Âä†ËΩΩÊé•Âè£Êï∞ÊçÆÂ§±Ë¥•')
    router.back()
  } finally {
    loading.value = false
  }
}

// ÂàùÂßãÂåñË°®ÂçïÊï∞ÊçÆ
const initializeFormData = () => {
  if (!interfaceData.value) return
  
  // ÂàùÂßãÂåñURLÂèÇÊï∞
  interfaceData.value.urlParams?.forEach(param => {
    if (param.defaultValue !== undefined) {
      executeForm.params[param.name] = param.defaultValue
    }
  })
  
  // ÂàùÂßãÂåñHeaderÂèÇÊï∞
  interfaceData.value.headerParams?.forEach(param => {
    if (param.defaultValue !== undefined) {
      executeForm.headers[param.name] = param.defaultValue
    }
  })
  
  // ÂàùÂßãÂåñBodyÂèÇÊï∞
  interfaceData.value.bodyParams?.forEach(param => {
    if (param.defaultValue !== undefined) {
      executeForm.bodyParams[param.name] = param.defaultValue
    }
  })
}

// ËøîÂõû‰∏ä‰∏ÄÈ°µ
const handleBack = () => {
  router.back()
}

// ÊâßË°åÊé•Âè£
const handleExecute = async () => {
  if (!interfaceData.value) return
  
  try {
    executing.value = true
    executeResult.value = null
    
    const request: ApiExecuteRequest = {
      interfaceId: interfaceData.value.id!,
      url: interfaceData.value.url!,
      method: interfaceData.value.method!,
      postType: interfaceData.value.postType,
      headers: executeForm.headers,
      urlParams: executeForm.params,
      bodyParams: executeForm.bodyParams
    }
    
    const response = await interfaceApi.execute(request)
    executeResult.value = response.data
    activeTab.value = 'response'
    
    message.success('Êé•Âè£ÊâßË°åÊàêÂäü')
  } catch (error: any) {
    console.error('Êé•Âè£ÊâßË°åÂ§±Ë¥•:', error)
    message.error(error.response?.data?.message || 'Êé•Âè£ÊâßË°åÂ§±Ë¥•')
  } finally {
    executing.value = false
  }
}

// Ëé∑ÂèñËæìÂÖ•ÁªÑ‰ª∂
const getInputComponent = (param: ApiParam) => {
  switch (param.inputType) {
    case 'SELECT':
      return 'a-select'
    case 'TEXTAREA':
      return 'a-textarea'
    case 'CODE':
      return 'a-textarea'
    case 'NUMBER':
      return 'a-input-number'
    case 'DATE':
      return 'a-date-picker'
    case 'DATETIME':
      return 'a-date-picker'
    default:
      return 'a-input'
  }
}

// Ëé∑ÂèñËæìÂÖ•ÁªÑ‰ª∂ÁªëÂÆöÂ±ûÊÄß
const getInputBindings = (param: ApiParam, type: 'params' | 'headers' | 'bodyParams') => {
  const baseProps = {
    ...getDatePickerProps(param),
    ...getCodeEditorProps(param)
  }
  
  // Ê†πÊçÆÁªÑ‰ª∂Á±ªÂûãÈÄâÊã©‰∏çÂêåÁöÑ v-model ÁªëÂÆöÊñπÂºè
  if (param.inputType === 'CODE') {
    return {
      ...baseProps,
      modelValue: executeForm[type][param.name] || '',
      'onUpdate:modelValue': (value: string) => {
        executeForm[type][param.name] = value
      }
    }
  } else {
    return {
      ...baseProps,
      value: executeForm[type][param.name],
      'onUpdate:value': (value: any) => {
        executeForm[type][param.name] = value
      }
    }
  }
}

// Ëé∑ÂèñÊó•ÊúüÈÄâÊã©Âô®Â±ûÊÄß
const getDatePickerProps = (param: ApiParam) => {
  if (param.inputType === 'DATE') {
    return {
      format: 'YYYY-MM-DD',
      valueFormat: 'YYYY-MM-DD'
    }
  } else if (param.inputType === 'DATETIME') {
    return {
      showTime: true,
      format: 'YYYY-MM-DD HH:mm:ss',
      valueFormat: 'YYYY-MM-DD HH:mm:ss'
    }
  }
  return {}
}

// Ëé∑Âèñ‰ª£Á†ÅÁºñËæëÂô®Â±ûÊÄß
const getCodeEditorProps = (param: ApiParam) => {
  if (param.inputType === 'CODE') {
    return {
      height: 200,
      options: {
        minimap: { enabled: true },
        scrollBeyondLastLine: false,
        wordWrap: 'on' as const,
        lineNumbers: 'on' as const,
        folding: true,
        fontSize: 16,
        fontFamily: 'Monaco, Menlo, Ubuntu Mono, monospace',
        lineHeight: 24,
        readOnly: false
      }
    }
  }
  return {}
}

// Ê†ºÂºèÂåñÂìçÂ∫î‰Ωì
const formatResponseBody = (body: string) => {
  try {
    const parsed = JSON.parse(body)
    return JSON.stringify(parsed, null, 2)
  } catch {
    return body
  }
}

// Ê†ºÂºèÂåñÂìçÂ∫îÂ§¥
const formatHeaders = (headers: Record<string, string>) => {
  return Object.entries(headers)
    .map(([key, value]) => `${key}: ${value}`)
    .join('\n')
}

// Ê£ÄÊµãÂìçÂ∫îËØ≠Ë®Ä
const detectResponseLanguage = (body: string): string => {
  if (!body || body.trim() === '') {
    return 'text'
  }

  const trimmedBody = body.trim()
  
  // JSONÊ£ÄÊµã
  if (trimmedBody.startsWith('{') && trimmedBody.endsWith('}') ||
      trimmedBody.startsWith('[') && trimmedBody.endsWith(']')) {
    try {
      JSON.parse(trimmedBody)
      return 'json'
    } catch {
      // ‰∏çÊòØÊúâÊïàÁöÑJSONÔºåÁªßÁª≠Ê£ÄÊµãÂÖ∂‰ªñÊ†ºÂºè
    }
  }
  
  // XMLÊ£ÄÊµã
  if (trimmedBody.startsWith('<') && trimmedBody.endsWith('>')) {
    return 'xml'
  }
  
  // HTMLÊ£ÄÊµã
  if (trimmedBody.includes('<html') || trimmedBody.includes('<div') || trimmedBody.includes('<p')) {
    return 'html'
  }
  
  // CSSÊ£ÄÊµã
  if (trimmedBody.includes('{') && trimmedBody.includes('}') && trimmedBody.includes(':')) {
    return 'css'
  }
  
  // JavaScriptÊ£ÄÊµã
  if (trimmedBody.includes('function') || trimmedBody.includes('=>') || trimmedBody.includes('const ')) {
    return 'javascript'
  }
  
  // SQLÊ£ÄÊµã
  if (trimmedBody.toUpperCase().includes('SELECT') || trimmedBody.toUpperCase().includes('INSERT') || 
      trimmedBody.toUpperCase().includes('UPDATE') || trimmedBody.toUpperCase().includes('DELETE')) {
    return 'sql'
  }
  
  // YAMLÊ£ÄÊµã
  if (trimmedBody.includes(':') && trimmedBody.includes('\n') && !trimmedBody.includes('{')) {
    return 'yaml'
  }
  
  // ÈªòËÆ§ËøîÂõûÊñáÊú¨
  return 'text'
}

// ‰ª£Á†ÅÁºñËæëÂô®Áõ∏ÂÖ≥ÊñπÊ≥ï
const getCodePreview = (value: string | undefined): string => {
  if (!value || value.trim() === '') {
    return ''
  }
  
  // Â¶ÇÊûúÂÜÖÂÆπÂ§™ÈïøÔºåÊòæÁ§∫Ââç50‰∏™Â≠óÁ¨¶
  if (value.length > 50) {
    return value.substring(0, 50) + '...'
  }
  
  return value
}

const getCodeLanguage = (): string => {
  if (currentCodeParam.value?.param.dataType === 'JSON') {
    return 'json'
  }
  return 'json' // ÈªòËÆ§‰ΩøÁî®JSON
}

const getCodePlaceholder = (): string => {
  if (currentCodeParam.value) {
    return `ËØ∑ËæìÂÖ•${currentCodeParam.value.param.name}...`
  }
  return 'ËØ∑ËæìÂÖ•‰ª£Á†Å...'
}

const openCodeEditor = (param: ApiParam, type: 'params' | 'headers' | 'bodyParams') => {
  currentCodeParam.value = { param, type }
  tempCodeValue.value = executeForm[type][param.name] || ''
  codeEditorVisible.value = true
}

const handleCodeConfirm = (value: string) => {
  if (currentCodeParam.value) {
    executeForm[currentCodeParam.value.type][currentCodeParam.value.param.name] = value
  }
  codeEditorVisible.value = false
  currentCodeParam.value = null
}

const handleCodeCancel = () => {
  codeEditorVisible.value = false
  currentCodeParam.value = null
}

// Ëé∑ÂèñËØ∑Ê±ÇÊñπÊ≥ïÈ¢úËâ≤
const getMethodColor = (method: string) => {
  const colors: Record<string, string> = {
    GET: 'blue',
    POST: 'green',
    PUT: 'orange',
    DELETE: 'red',
    PATCH: 'purple',
    HEAD: 'cyan',
    OPTIONS: 'geekblue'
  }
  return colors[method] || 'default'
}

// Ëé∑ÂèñPOSTÁ±ªÂûãÊ†áÁ≠æ
const getPostTypeLabel = (postType: string) => {
  const type = POST_TYPES.find(t => t.value === postType)
  return type ? type.label : postType
}

// Ê†ºÂºèÂåñÊó•ÊúüÊó∂Èó¥
const formatDateTime = (dateTime: string | Date | undefined): string => {
  if (!dateTime) return 'ÊöÇÊó†'
  
  const date = new Date(dateTime)
  return date.toLocaleString('zh-CN', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  })
}
</script>

<style scoped>
.interface-execute-page {
  min-height: 100%;
  background: #f0f2f5;
  padding: 0;
}

.form-header {
  margin-bottom: 8px;
  padding: 0 16px;
  margin-top: 16px;
}

.header-content {
  display: flex;
  align-items: center;
  background: #fff;
  border-radius: 6px;
  padding: 12px 16px;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
  border: 1px solid #f0f0f0;
}

.header-icon {
  width: 36px;
  height: 36px;
  background: linear-gradient(135deg, var(--primary-color, #1890ff), var(--secondary-color, #40a9ff));
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 12px;
  box-shadow: 0 2px 6px var(--shadow-color, rgba(24, 144, 255, 0.15));
}

.header-icon :deep(.anticon) {
  font-size: 18px;
  color: white;
}

.header-text {
  flex: 1;
}

.header-title {
  margin: 0 0 2px 0;
  font-size: 15px;
  font-weight: 600;
  color: #1a1a1a;
  line-height: 1.2;
}

.header-subtitle {
  margin: 0;
  font-size: 11px;
  color: #666;
  line-height: 1.2;
}

.form-content {
  padding: 0 16px 16px;
}

.form-card {
  border-radius: 6px;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
  border: 1px solid #f0f0f0;
}

/* Ë°®ÂçïÂå∫ÂüüÊ†∑Âºè */
.form-section {
  margin-bottom: 24px;
}

.section-header {
  display: flex;
  align-items: center;
  margin-bottom: 12px;
  padding-bottom: 6px;
  border-bottom: 1px solid #f0f0f0;
}

.section-icon {
  width: 20px;
  height: 20px;
  border-radius: 4px;
  background: linear-gradient(135deg, var(--primary-color, #1890ff), var(--secondary-color, #40a9ff));
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 6px;
  box-shadow: 0 1px 3px var(--shadow-color, rgba(24, 144, 255, 0.12));
}

.section-icon :deep(.anticon) {
  font-size: 10px;
  color: white;
}

.section-title {
  font-size: 13px;
  font-weight: 600;
  color: #1a1a1a;
  margin-right: 6px;
}

/* Êìç‰ΩúÊåâÈíÆÊ†∑Âºè */
.form-actions {
  padding: 12px 0 0 0;
  margin-top: 16px;
  border-top: 1px solid #f0f0f0;
  text-align: center;
}

.submit-btn {
  border-radius: 4px;
  transition: all 0.2s ease;
  min-width: 100px;
  font-size: 13px;
}

.submit-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 8px var(--shadow-color, rgba(24, 144, 255, 0.2));
}

.cancel-btn {
  border-radius: 4px;
  transition: all 0.2s ease;
  min-width: 80px;
  font-size: 13px;
}

.cancel-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.loading-container {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 200px;
}

.no-result {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 200px;
}

.param-group {
  margin-bottom: 24px;
}

.param-group h4 {
  margin-bottom: 16px;
  color: #1890ff;
  font-weight: 600;
}

.param-row {
  margin-bottom: 16px;
}

.param-label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: #333;
}

.required {
  color: #ff4d4f;
  margin-left: 4px;
}

.no-params {
  text-align: center;
  padding: 40px 0;
}

.response-container {
  height: 100%;
}

.response-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 1px solid #f0f0f0;
}

.response-time {
  font-size: 12px;
  color: #666;
}

.response-body {
  padding: 0;
}

.headers-container,
.error-container {
  padding: 16px;
  border: 1px solid #d9d9d9;
  border-radius: 6px;
  background: #fafafa;
  max-height: 300px;
  overflow-y: auto;
}

.headers-container pre,
.error-container pre {
  margin: 0;
  white-space: pre-wrap;
  word-break: break-word;
}

/* ‰ª£Á†ÅÁºñËæëÂô®ËæìÂÖ•Ê†∑Âºè */
.code-editor-input {
  width: 100%;
}

.code-preview-input {
  cursor: pointer;
}

.code-preview-input :deep(.ant-input) {
  background-color: #f8f9fa;
  border: 1px solid #d0d7de;
  color: #656d76;
  font-family: Monaco, Menlo, "Ubuntu Mono", monospace;
  font-size: 12px;
  cursor: pointer;
}

.code-preview-input :deep(.ant-input):hover {
  border-color: #40a9ff;
  background-color: #ffffff;
  box-shadow: 0 0 0 2px rgba(9, 105, 218, 0.1);
}

.code-preview-input :deep(.ant-input):focus {
  border-color: #0969da;
  background-color: #ffffff;
  box-shadow: 0 0 0 2px rgba(9, 105, 218, 0.2);
}

/* Âü∫Êú¨‰ø°ÊÅØÊ†∑Âºè */
.info-card {
  margin: 0 0 24px 0;
  margin-right: 24px;
  background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}

.content-row {
  margin: 0;
  margin-right: 24px;
}

.card-title {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
  color: #1890ff;
}

.title-icon {
  font-size: 16px;
}

.interface-info {
  padding: 8px 0;
}

.info-value {
  font-weight: 500;
  color: #333;
}

.url-text {
  background: linear-gradient(135deg, #e6f7ff 0%, #f0f9ff 100%);
  padding: 6px 12px;
  border-radius: 6px;
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  font-size: 13px;
  color: #1890ff;
  word-break: break-all;
  border: 1px solid #d6e4ff;
}

.description-text {
  color: #666;
  line-height: 1.5;
}

.method-tag,
.post-type-tag,
.status-tag {
  font-weight: 500;
  border-radius: 6px;
  padding: 2px 8px;
}

.time-text {
  color: #999;
  font-size: 13px;
}

:deep(.ant-descriptions-item-label) {
  font-weight: 500;
  color: #666;
  background: #fafafa;
  padding: 8px 12px;
  border-radius: 6px;
  margin-right: 12px;
  min-width: 80px;
}

:deep(.ant-descriptions-item-content) {
  color: #333;
  padding: 8px 0;
}

:deep(.ant-descriptions-item) {
  margin-bottom: 8px;
  padding: 4px 0;
}
</style>
